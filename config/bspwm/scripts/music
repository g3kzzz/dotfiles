#!/bin/bash
# =====================================================
#         ðŸŽ§ Music Playlist Manager (BSPWM)
#               â€” by g3k / minimal cyan â€”
# =====================================================

MUSIC_DIR="$HOME/.config/music"
PLAYER="mpv"
CYAN="\e[36m"
RESET="\e[0m"
BOLD="\e[1m"
NOTIFY_ID=6666

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# FunciÃ³n: animaciÃ³n simple
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loading() {
  local msg="$1"
  echo -ne "${CYAN}${msg}${RESET}"
  for c in '.' '..' '...'; do
    echo -ne "\r${CYAN}${msg}${c}${RESET}"
    sleep 0.3
  done
  echo -e "\r${CYAN}${msg}... listo!${RESET}"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# FunciÃ³n: notificaciÃ³n (sin imagen)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
notify_cyan() {
  local title="$1"
  local message="$2"
  dunstify -r "$NOTIFY_ID" -u normal -t 3000 -h string:x-dunst-stack-tag:music "$title" "$message"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# FunciÃ³n: validar carpeta y archivos
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
validate_music_dir() {
  if [ ! -d "$MUSIC_DIR" ]; then
    echo -e "${CYAN}âš  Carpeta no encontrada:${RESET} $MUSIC_DIR"
    notify_cyan "Music Player" "âš  Carpeta no encontrada en $MUSIC_DIR"
    exit 1
  fi

  local mp3_count
  mp3_count=$(find "$MUSIC_DIR" -maxdepth 1 -type f -iname "*.mp3" | wc -l)
  if [ "$mp3_count" -eq 0 ]; then
    echo -e "${CYAN}âš  No hay archivos MP3 en:${RESET} $MUSIC_DIR"
    notify_cyan "Music Player" "âš  No se encontraron archivos MP3"
    exit 1
  fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# FunciÃ³n: verificar si mpv estÃ¡ activo
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
is_playing() {
  pgrep -f "mpv.*$MUSIC_DIR" >/dev/null
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# MAIN
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
clear
echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
echo -e "${CYAN}â•‘        MUSIC PLAYLIST MANAGER ðŸŽµ             â•‘${RESET}"
echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
echo

validate_music_dir

if is_playing; then
  echo -e "${CYAN}ðŸŽ¶ ReproducciÃ³n activa â€” deteniendo...${RESET}"
  loading "Deteniendo mÃºsica"
  pkill -f "mpv.*$MUSIC_DIR"
  if ! is_playing; then
    echo -e "${CYAN}âœ… MÃºsica detenida.${RESET}"
    notify_cyan "Music Player" "MÃºsica detenida correctamente ðŸŽµ"
  else
    echo -e "${CYAN}âœ– Error al detener la mÃºsica.${RESET}"
    notify_cyan "Music Player" "Error al detener reproducciÃ³n âš "
  fi
else
  echo -e "${CYAN}ðŸŽ§ Iniciando playlist...${RESET}"
  loading "Cargando MPV"
  nohup "$PLAYER" --no-video --loop=inf --shuffle "$MUSIC_DIR"/*.mp3 >/dev/null 2>&1 &
  sleep 1
  if is_playing; then
    echo -e "${CYAN}âœ… Playlist iniciada correctamente.${RESET}"
    notify_cyan "Music Player" "Playlist en reproducciÃ³n ðŸŽ¶"
  else
    echo -e "${CYAN}âœ– Error al iniciar playlist.${RESET}"
    notify_cyan "Music Player" "No se pudo iniciar la playlist âš "
  fi
fi
